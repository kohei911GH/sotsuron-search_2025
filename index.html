<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>卒論 抄録目次（会場付）キーワード検索</title>
<style>
  :root {
    --bg:#fff;
    --fg:#111;
    --muted:#666;
    --card:#fff;
    --line:#ddd;
    --line2:#eee;
    --pill:#f2f2f2;
    --accent:#111;
    --accent2:#0b57d0;
    --star:#f5c542;
    --danger:#b00020;
    --radius:14px;
  }
  * { box-sizing: border-box; }
  body {
    font-family: system-ui, -apple-system, "Noto Sans JP", sans-serif;
    margin: 16px;
    color: var(--fg);
    background: var(--bg);
  }
  h2 { margin: 0 0 6px; font-size: 18px; }
  .muted { color: var(--muted); }
  .small { font-size: 12px; }
  .card {
    border: 1px solid var(--line);
    border-radius: var(--radius);
    padding: 12px;
    margin: 12px 0;
    background: var(--card);
  }
  .row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
  }
  .row.tight { gap: 8px; }
  .grow { flex: 1 1 280px; }
  input[type="text"] {
    width: 100%;
    padding: 12px 12px;
    border: 1px solid #ccc;
    border-radius: 12px;
    font-size: 16px; /* mobile: prevent zoom */
  }
  button {
    padding: 10px 12px;
    border: 0;
    border-radius: 12px;
    cursor: pointer;
    font-size: 14px;
    background: var(--pill);
  }
  button.primary {
    background: var(--accent);
    color: #fff;
  }
  button.ghost {
    background: transparent;
    border: 1px solid var(--line);
  }
  button.danger {
    background: transparent;
    border: 1px solid #f0b7c0;
    color: var(--danger);
  }
  button:disabled { opacity: .5; cursor: not-allowed; }
  label { user-select: none; color: #444; display:flex; align-items:center; gap:6px; }
  .pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    border-radius: 999px;
    background: var(--pill);
    font-size: 12px;
    white-space: nowrap;
  }
  .seg {
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    align-items:center;
  }
  .tabs {
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  .tab {
    padding: 8px 12px;
    border-radius: 999px;
    border: 1px solid var(--line);
    background: #fff;
    cursor: pointer;
    font-size: 13px;
  }
  .tab.active {
    background: var(--accent);
    color:#fff;
    border-color: var(--accent);
  }

  /* Desktop table */
  .tableWrap {
    max-height: 62vh;
    overflow: auto;
    border-radius: 12px;
    border: 1px solid var(--line2);
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    border-bottom: 1px solid var(--line2);
    padding: 10px;
    vertical-align: top;
    font-size: 14px;
  }
  th {
    background: #fafafa;
    position: sticky;
    top: 0;
    text-align: left;
    z-index: 1;
  }
  .mono {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  }
  .nowrap { white-space: nowrap; }
  mark { border-radius: 4px; padding: 0 2px; }
  .wrap { white-space: pre-wrap; }

  /* Favorite star button */
  .starBtn {
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width: 34px;
    height: 34px;
    border-radius: 10px;
    border: 1px solid var(--line);
    background: #fff;
    cursor: pointer;
  }
  .starBtn[aria-pressed="true"] {
    border-color: #f0d27a;
    background: #fff9e6;
  }
  .star {
    font-size: 18px;
    line-height: 1;
    color: #999;
  }
  .star.on { color: var(--star); }

  /* Mobile: card list view */
  .list {
    display:none;
    gap:10px;
    flex-direction: column;
  }
  .item {
    border: 1px solid var(--line2);
    border-radius: 14px;
    padding: 12px;
    background: #fff;
    display:flex;
    gap: 10px;
  }
  .itemMain { flex: 1; min-width: 0; }
  .title {
    font-weight: 700;
    margin-bottom: 6px;
    white-space: pre-wrap;
    word-break: break-word;
  }
  .meta {
    display:flex;
    gap: 8px;
    flex-wrap:wrap;
  }
  .meta .pill { background:#f7f7f7; }

  /* Responsive switch */
  @media (max-width: 820px) {
    body { margin: 12px; }
    h2 { font-size: 17px; }
    th, td { font-size: 13px; }
    .tableWrap { display:none; }
    .list { display:flex; }
  }
</style>
</head>
<body>
<h2>卒論 抄録目次（会場付）キーワード検索</h2>
<div class="muted small">このページは端末内（ブラウザ）で完結します。お気に入りは <b>この端末のブラウザ</b> に保存されます（ネット送信なし）。</div>

<div class="card">
  <div class="tabs">
    <button id="tabSearch" class="tab active" type="button">検索</button>
    <button id="tabFav" class="tab" type="button">お気に入り <span class="pill">件数: <span id="favCount">0</span></span></button>
  </div>

  <div id="panelSearch" style="margin-top:12px;">
    <div class="row tight">
      <div class="grow">
        <input id="q" type="text" placeholder="キーワード（例：愛着 / 不登校 / ゲーム / モンテッソーリ など）" />
      </div>
      <button id="search" class="primary" type="button">検索</button>
      <button id="clear" type="button">クリア</button>
    </div>

    <div class="row" style="margin-top:10px;">
      <span class="pill">ヒット: <span id="hit">0</span></span>
      <span class="pill">総件数: <span id="total">0</span></span>
      <span class="pill">お気に入り: <span id="favCount2">0</span></span>
    </div>

    <div class="row" style="margin-top:10px;">
      <label><input id="ignoreCase" type="checkbox" checked> 大文字小文字無視</label>
      <label><input id="andMode" type="checkbox"> 複数語AND（スペース区切り）</label>
      <label><input id="searchAll" type="checkbox"> タイトル以外も検索（氏名/学籍番号/会場/ページ）</label>
      <label><input id="highlight" type="checkbox" checked> ハイライト</label>
      <span class="muted small">※既定は「卒業論文タイトルのみ」検索</span>
    </div>
  </div>

  <div id="panelFav" style="display:none; margin-top:12px;">
    <div class="row tight">
      <div class="grow">
        <input id="fq" type="text" placeholder="お気に入り内を検索（空欄で全件）" />
      </div>
      <button id="fsearch" class="primary" type="button">検索</button>
      <button id="fclear" type="button">クリア</button>
      <button id="exportFav" class="ghost" type="button">CSV出力</button>
      <button id="clearFav" class="danger" type="button">全解除</button>
    </div>
    <div class="row" style="margin-top:10px;">
      <span class="pill">お気に入り件数: <span id="favCount3">0</span></span>
      <span class="muted small">※お気に入りはこの端末のブラウザに保存されます（localStorage）。</span>
    </div>
  </div>
</div>

<!-- Results (desktop table + mobile list) -->
<div class="card" id="resultsCard">
  <div class="muted small" id="resultsHint">検索語を入力して検索してください。</div>

  <div class="tableWrap" style="margin-top:10px;">
    <table>
      <thead>
        <tr>
          <th style="width:56px;">★</th>
          <th class="nowrap">学籍番号</th>
          <th class="nowrap">氏名</th>
          <th>卒業論文タイトル</th>
          <th class="nowrap">ページ</th>
          <th class="nowrap">会場</th>
          <th class="nowrap">発表開始時刻</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td colspan="7" class="muted">検索語を入力して検索してください。</td></tr>
      </tbody>
    </table>
  </div>

  <div class="list" id="list">
    <!-- mobile cards -->
  </div>
</div>

<script>
  const DATA = [{"学籍番号": "7228001", "氏名": "青木　理奈", "卒業論文タイトル": "日本の幼児教育における「空気を読む」文化の形成過程 
―国民性との関連を中心に―", "ページ": "p.1", "会場": "A301", "発表開始時刻": "14:00"}, {"学籍番号": "7228002", "氏名": "阿山　偉生", "卒業論文タイトル": "父親の育児参加が家族の心理的幸福感に及ぼす影響", "ページ": "p.2", "会場": "B401", "発表開始時刻": "9:45"}, {"学籍番号": "7228003", "氏名": "荒本　朝希", "卒業論文タイトル": "恥ずかしさの理解と学校教育における支援の在り方", "ページ": "p.3", "会場": "B101", "発表開始時刻": "9:45"}, {"学籍番号": "7228004", "氏名": "石川　遥", "卒業論文タイトル": "ポケモンを教育・子育てに活用するための一考察", "ページ": "p.4", "会場": "B101", "発表開始時刻": "10:00"}, {"学籍番号": "7228005", "氏名": "猪谷　美月", "卒業論文タイトル": "スマートフォンが与える乳幼児への影響", "ページ": "p.5", "会場": "B201", "発表開始時刻": "9:45"}, {"学籍番号": "7228006", "氏名": "井上　そら", "卒業論文タイトル": "子どもの「好きな先生」とはどのような教師か", "ページ": "p.6", "会場": "B201", "発表開始時刻": "10:15"}, {"学籍番号": "7228007", "氏名": "岩橋　翔子", "卒業論文タイトル": "幼少期における移行対象経験の有無が
現在のパーソナリティ傾向に与える影響", "ページ": "p.7", "会場": "B401", "発表開始時刻": "10:00"}, {"学籍番号": "7228008", "氏名": "岩本　晴香", "卒業論文タイトル": "カナダでの保育ボランティアを通して気付いた
日本の保育の強みと課題", "ページ": "p.8", "会場": "A301", "発表開始時刻": "13:15"}, {"学籍番号": "7228009", "氏名": "上原　花音", "卒業論文タイトル": "登校しぶり事例にみる教育者の視点や関わり", "ページ": "p.9", "会場": "A301", "発表開始時刻": "13:30"}, {"学籍番号": "7228010", "氏名": "氏家　瑛美", "卒業論文タイトル": "鬼ごっこが長年好まれ続ける理由", "ページ": "p.10", "会場": "B302", "発表開始時刻": "10:00"}, {"学籍番号": "7228011", "氏名": "内田　優花", "卒業論文タイトル": "保育・教育現場で直面する見えていない“性”の困りごと
-理解を深めるための支援と教育-", "ページ": "p.11", "会場": "B404", "発表開始時刻": "11:15"}, {"学籍番号": "7228012", "氏名": "梅原　涼之", "卒業論文タイトル": "幼児・児童期の環境と非認知能力の関係", "ページ": "p.12", "会場": "B401", "発表開始時刻": "10:15"}, {"学籍番号": "7228013", "氏名": "漆谷　海音", "卒業論文タイトル": "子どもの「やりたい気持ち」を尊重する教育とは何か
―モンテッソーリ教育の視点から―", "ページ": "p.13", "会場": "A301", "発表開始時刻": "13:45"}, {"学籍番号": "7228014", "氏名": "榎田　凜音", "卒業論文タイトル": "コレクション文化としてのシール帳～心理的・発達的意義の考察～", "ページ": "p.14", "会場": "B302", "発表開始時刻": "10:15"}, {"学籍番号": "7228015", "氏名": "應治　薫", "卒業論文タイトル": "運動会の集団演技における音楽と振り付けに対する教員の選択意図", "ページ": "p.15", "会場": "B301", "発表開始時刻": "10:00"}, {"学籍番号": "7228016", "氏名": "大石　瑠奈", "卒業論文タイトル": "算数の苦手意識を減らす手立て　～たし算～", "ページ": "p.16", "会場": "B403", "発表開始時刻": "10:00"}, {"学籍番号": "7228017", "氏名": "大江　瑚町", "卒業論文タイトル": "字形と姿勢の関係", "ページ": "p.17", "会場": "B403", "発表開始時刻": "10:15"}, {"学籍番号": "7228018", "氏名": "大隈　美穂", "卒業論文タイトル": "家庭での音楽経験が子どもにどのような影響を与えるのか", "ページ": "p.18", "会場": "B301", "発表開始時刻": "10:15"}, {"学籍番号": "7228019", "氏名": "大崎　夢叶", "卒業論文タイトル": "異文化理解と多様性について
～韓国の伝承遊びを通じて～", "ページ": "p.19", "会場": "B302", "発表開始時刻": "9:45"}, {"学籍番号": "7228021", "氏名": "大野　愛佳", "卒業論文タイトル": "冒険教育のインストラクション経験が保育・教育学生に及ぼす影響", "ページ": "p.20", "会場": "B401", "発表開始時刻": "10:30"}, {"学籍番号": "7228022", "氏名": "大野　涼夏", "卒業論文タイトル": "運動習慣の変化が心身の健康に与える影響", "ページ": "p.21", "会場": "B401", "発表開始時刻": "10:45"}, {"学籍番号": "7228023", "氏名": "大原　梓", "卒業論文タイトル": "家庭内の不快経験がHSPに与える影響", "ページ": "p.22", "会場": "B401", "発表開始時刻": "11:00"}, {"学籍番号": "7228025", "氏名": "大峰　悠稔", "卒業論文タイトル": "NEXT GIGAにおけるデジタルゲームを活用した教材設計", "ページ": "p.23", "会場": "B101", "発表開始時刻": "10:15"}, {"学籍番号": "7228026", "氏名": "大森　愛子", "卒業論文タイトル": "プロ野球とアイドルのファン文化比較からみる推しの教育的機能", "ページ": "p.24", "会場": "B301", "発表開始時刻": "10:30"}, {"学籍番号": "7228027", "氏名": "岡城　志奈", "卒業論文タイトル": "下腿筋厚と疾走速度との関連性", "ページ": "p.25", "会場": "B201", "発表開始時刻": "10:30"}, {"学籍番号": "7228028", "氏名": "岡田　悠花", "卒業論文タイトル": "ことばの発達に遅れがみられるこどものことばを育む環境について", "ページ": "p.26", "会場": "A201", "発表開始時刻": "9:45"}, {"学籍番号": "7228029", "氏名": "奥井　紗香", "卒業論文タイトル": "指先の発達を促す玩具の発達支援
―円を描く能力に着目してー", "ページ": "p.27", "会場": "B302", "発表開始時刻": "10:30"}, {"学籍番号": "7228030", "氏名": "尾崎　芽衣", "卒業論文タイトル": "父性意識の形成過程", "ページ": "p.28", "会場": "B402", "発表開始時刻": "10:45"}, {"学籍番号": "7228031", "氏名": "小澤　彩弥", "卒業論文タイトル": "なぜ子どもはテーマパークに惹かれるのか", "ページ": "p.29", "会場": "B201", "発表開始時刻": "10:45"}, {"学籍番号": "7228032", "氏名": "鹿島　亜美", "卒業論文タイトル": "絵本の魅力を引き出す翻訳の秘密
～レオニ『スイミー』の谷川俊太郎訳・筆者訳・AI訳の比較検討から～", "ページ": "p.30", "会場": "A301", "発表開始時刻": "9:45"}, {"学籍番号": "7228034", "氏名": "川口　恵梨奈", "卒業論文タイトル": "保育・教育現場における海外にルーツを持つ子どもたちの
保育・教育の在り方", "ページ": "p.31", "会場": "B201", "発表開始時刻": "11:00"}, {"学籍番号": "7228035", "氏名": "川端　涼華", "卒業論文タイトル": "海外にルーツをもつ子どもの日本語習得にかかる時間", "ページ": "p.32", "会場": "B402", "発表開始時刻": "11:00"}, {"学籍番号": "7228036", "氏名": "河渕　真帆", "卒業論文タイトル": "睡眠の量・質と記憶の定着との関係について", "ページ": "p.33", "会場": "B401", "発表開始時刻": "11:15"}, {"学籍番号": "7228037", "氏名": "菊内　美緒", "卒業論文タイトル": "「生きるためのファンタジー」として読む児童文学作品の考察", "ページ": "p.34", "会場": "B304", "発表開始時刻": "10:45"}, {"学籍番号": "7228038", "氏名": "岸川　茉愛", "卒業論文タイトル": "時代とともに変わるこどもの遊びと家族
―プリキュアシリーズを通してー", "ページ": "p.35", "会場": "B301", "発表開始時刻": "10:45"}, {"学籍番号": "7228039", "氏名": "木村　優作", "卒業論文タイトル": "靴のサイズへの意識", "ページ": "p.36", "会場": "B201", "発表開始時刻": "11:15"}, {"学籍番号": "7228040", "氏名": "久藤　優月", "卒業論文タイトル": "笑顔の自己認知と対人関係に与える作用", "ページ": "p.37", "会場": "B302", "発表開始時刻": "10:45"}, {"学籍番号": "7228041", "氏名": "源田　間央美", "卒業論文タイトル": "木育の可能性
～Aおもちゃ美術館での参与観察を中心に～", "ページ": "p.38", "会場": "B402", "発表開始時刻": "9:45"}, {"学籍番号": "7228042", "氏名": "古村　倖奈", "卒業論文タイトル": "精神疾患で休職する教員の休職中の過ごし方と
求められる復職支援について", "ページ": "p.39", "会場": "A301", "発表開始時刻": "10:00"}, {"学籍番号": "7228043", "氏名": "西條　瑛美里", "卒業論文タイトル": "応援ソングが人々のレジリエンスに与える影響", "ページ": "p.40", "会場": "B401", "発表開始時刻": "11:30"}, {"学籍番号": "7228044", "氏名": "坂脇　柚", "卒業論文タイトル": "不登校児と職員の関わりと登校支援の活動記録", "ページ": "p.41", "会場": "B403", "発表開始時刻": "10:30"}, {"学籍番号": "7228045", "氏名": "佐藤　里桜", "卒業論文タイトル": "誇張された顔の絵に対する印象は子どもと大人で一致するのか", "ページ": "p.42", "会場": "B402", "発表開始時刻": "11:15"}, {"学籍番号": "7228046", "氏名": "塩山　詩織", "卒業論文タイトル": "『ハイキュー!!』にみる成長の心理学
―日向翔陽と影山飛雄の変化をアドラー心理学から読み解く―", "ページ": "p.43", "会場": "B302", "発表開始時刻": "11:00"}, {"学籍番号": "7228047", "氏名": "下之坊　凜", "卒業論文タイトル": "父親から見た夫婦関係満足度の高さと妻との
コミュニケーションに関する考察", "ページ": "p.44", "会場": "B302", "発表開始時刻": "11:15"}, {"学籍番号": "7228048", "氏名": "芝　瑞穂", "卒業論文タイトル": "緊張のしやすさと自尊感情の関係性", "ページ": "p.45", "会場": "B302", "発表開始時刻": "13:15"}, {"学籍番号": "7228049", "氏名": "柴田　真依", "卒業論文タイトル": "習い事が子どもに与える影響", "ページ": "p.46", "会場": "B301", "発表開始時刻": "9:45"}, {"学籍番号": "7228050", "氏名": "澁谷　真帆", "卒業論文タイトル": "インクルーシブ遊具と設置者側の知的好奇心の関係", "ページ": "p.47", "会場": "B302", "発表開始時刻": "13:30"}, {"学籍番号": "7228051", "氏名": "白井　優梨奈", "卒業論文タイトル": "算数科におけるつまずきとユニバーサルデザイン", "ページ": "p.48", "会場": "B403", "発表開始時刻": "9:45"}, {"学籍番号": "7228052", "氏名": "杉山　朋乃佳", "卒業論文タイトル": "こどもの遊びが変化するきっかけ‐遊びの流れに着目して‐", "ページ": "p.49", "会場": "B301", "発表開始時刻": "11:00"}, {"学籍番号": "7228053", "氏名": "曽根　楓", "卒業論文タイトル": "きょうだい児を考える～「ライオンの隠れ家」と「1リットルの涙」を通して～", "ページ": "p.50", "会場": "B301", "発表開始時刻": "11:15"}, {"学籍番号": "7228055", "氏名": "田上　冴月", "卒業論文タイトル": "よりよい歌を選曲する視点とこどもの歌リストの作成", "ページ": "p.51", "会場": "B304", "発表開始時刻": "11:00"}, {"学籍番号": "7228056", "氏名": "髙本　唯莉", "卒業論文タイトル": "幼少期のダンス経験が自己肯定感へ与える影響", "ページ": "p.52", "会場": "B302", "発表開始時刻": "13:45"}, {"学籍番号": "7228057", "氏名": "武富　冬碧", "卒業論文タイトル": "保育実習前後で保育学生の好き嫌いや食育に対する意識は
変化するのか", "ページ": "p.53", "会場": "B302", "発表開始時刻": "14:00"}, {"学籍番号": "7228058", "氏名": "谷坂　栞羽", "卒業論文タイトル": "LGBTQ+当事者の自己受容と環境づくり
―自身のライフストーリーを通して―", "ページ": "p.54", "会場": "B304", "発表開始時刻": "9:45"}, {"学籍番号": "7228059", "氏名": "玉井　直都", "卒業論文タイトル": "日本家庭でできる第二言語習得のための取り組みの検討
～その課題とインターナショナル保育園の保育体験から得た工夫～", "ページ": "p.55", "会場": "B304", "発表開始時刻": "11:15"}, {"学籍番号": "7228060", "氏名": "辻中　佳穂子", "卒業論文タイトル": "こどもの居場所としてのリビングの研究
～家族との関係を通して～", "ページ": "p.56", "会場": "B402", "発表開始時刻": "10:00"}, {"学籍番号": "7228061", "氏名": "寺久保　紗彩", "卒業論文タイトル": "MBTI と自己理解～私とはだれか～", "ページ": "p.57", "会場": "B402", "発表開始時刻": "10:15"}, {"学籍番号": "7228062", "氏名": "寺戸　光莉", "卒業論文タイトル": "『トムとジェリ―』に学ぶ非言語コミュニケーションと保育への活用", "ページ": "p.58", "会場": "B302", "発表開始時刻": "11:30"}, {"学籍番号": "7228063", "氏名": "冨岡　英恵", "卒業論文タイトル": "放課後児童クラブの現状と可能性
～有意義な放課後のすごし方～", "ページ": "p.59", "会場": "B303", "発表開始時刻": "11:15"}, {"学籍番号": "7228064", "氏名": "冨田　咲来", "卒業論文タイトル": "乳幼児期における午睡と保育環境の在り方", "ページ": "p.60", "会場": "B404", "発表開始時刻": "9:45"}, {"学籍番号": "7228065", "氏名": "友田　舞衣", "卒業論文タイトル": "白木の積み木特有のよさとは何か", "ページ": "p.61", "会場": "B301", "発表開始時刻": "11:30"}, {"学籍番号": "7228067", "氏名": "長尾　大和", "卒業論文タイトル": "自己語りの理論と実践-自分を通してのライフストーリー ワーク-", "ページ": "p.62", "会場": "B304", "発表開始時刻": "10:00"}, {"学籍番号": "7228068", "氏名": "長﨑　栞奈", "卒業論文タイトル": "算数科デジタル教科書におけるコンテンツの可能性と課題について", "ページ": "p.63", "会場": "B401", "発表開始時刻": "13:45"}, {"学籍番号": "7228069", "氏名": "中田　風子", "卒業論文タイトル": "異年齢保育における子どもの成長と保育者の援助", "ページ": "p.64", "会場": "B404", "発表開始時刻": "10:00"}, {"学籍番号": "7228070", "氏名": "中村　幸夏", "卒業論文タイトル": "学習面で困り感のある子どもが通常学級で学ぶことは適切なのか", "ページ": "p.65", "会場": "A301", "発表開始時刻": "10:15"}, {"学籍番号": "7228071", "氏名": "新居　杏紗希", "卒業論文タイトル": "LGBTQ＋の子どもに対する学校内での支援のあり方", "ページ": "p.66", "会場": "A301", "発表開始時刻": "10:30"}, {"学籍番号": "7228073", "氏名": "西尾　友里", "卒業論文タイトル": "子ども服専門店における男女の色の分け方について", "ページ": "p.67", "会場": "A201", "発表開始時刻": "10:45"}, {"学籍番号": "7228074", "氏名": "錦織　麻菜", "卒業論文タイトル": "無性別キャラクターが登場する絵本の魅力について", "ページ": "p.68", "会場": "A201", "発表開始時刻": "11:00"}, {"学籍番号": "7228076", "氏名": "西村　来瞳", "卒業論文タイトル": "公園の固定遊具の整理と比較
―遊具が子どもの発達に与える影響―", "ページ": "p.69", "会場": "B404", "発表開始時刻": "10:15"}, {"学籍番号": "7228077", "氏名": "新田　美彩希", "卒業論文タイトル": "ダンス指導のおもしろさ
～インストラクターとしての参与授業を通して～", "ページ": "p.70", "会場": "B303", "発表開始時刻": "13:15"}, {"学籍番号": "7228079", "氏名": "野口　萌", "卒業論文タイトル": "子どもの遊びと非認知能力の関係", "ページ": "p.71", "会場": "B303", "発表開始時刻": "11:30"}, {"学籍番号": "7228080", "氏名": "野々村　陽向", "卒業論文タイトル": "子どもの聴く力を伸ばすための大人の関わり", "ページ": "p.72", "会場": "B303", "発表開始時刻": "9:45"}, {"学籍番号": "7228082", "氏名": "長谷川　実奈", "卒業論文タイトル": "乳児院における子どもと保育者の愛着形成について", "ページ": "p.73", "会場": "B304", "発表開始時刻": "11:30"}, {"学籍番号": "7228083", "氏名": "畑山　夏穂", "卒業論文タイトル": "『ハリー・ポッター』シリーズから学ぶ教育の在り方", "ページ": "p.74", "会場": "B101", "発表開始時刻": "10:30"}, {"学籍番号": "7228086", "氏名": "東　結歩", "卒業論文タイトル": "スターバックスの人材育成に学ぶ保育・教育現場への応用可能性", "ページ": "p.75", "会場": "B101", "発表開始時刻": "10:45"}, {"学籍番号": "7228087", "氏名": "平井　芙美香", "卒業論文タイトル": "現代社会における健康の在り方
～大人も子どもも健やかに生きるために～", "ページ": "p.76", "会場": "B303", "発表開始時刻": "10:00"}, {"学籍番号": "7228088", "氏名": "平岡　菜彩", "卒業論文タイトル": "リズム遊びとの向き合い方について―指導者へのインタビューを通して―", "ページ": "p.77", "会場": "B303", "発表開始時刻": "13:30"}, {"学籍番号": "7228089", "氏名": "平野　樹莉亜", "卒業論文タイトル": "子どもたちにアイドルがどのような影響を与えるか 
～学生アンケートから見えたこと～", "ページ": "p.78", "会場": "B303", "発表開始時刻": "13:45"}, {"学籍番号": "7228090", "氏名": "平原　実咲", "卒業論文タイトル": "日本のクリスマス絵本におけるサンタクロース像", "ページ": "p.79", "会場": "A201", "発表開始時刻": "11:15"}, {"学籍番号": "7228091", "氏名": "平山　妃奈", "卒業論文タイトル": "手作り玩具の考察と子どもにとっての生活用品と玩具の関係性", "ページ": "p.80", "会場": "B201", "発表開始時刻": "13:15"}, {"学籍番号": "7228092", "氏名": "広瀬　彩乃", "卒業論文タイトル": "個別最適な学びと協働的な学びの一体的な充実
～児童の学習意欲向上のために～", "ページ": "p.81", "会場": "B303", "発表開始時刻": "10:15"}, {"学籍番号": "7228093", "氏名": "廣山　夏実", "卒業論文タイトル": "アイドルから学ぶ、子どもの注目の集め方", "ページ": "p.82", "会場": "B401", "発表開始時刻": "13:15"}, {"学籍番号": "7228094", "氏名": "福井　千尋", "卒業論文タイトル": "自然遊びの経験が成人後に与える影響について", "ページ": "p.83", "会場": "B402", "発表開始時刻": "13:15"}, {"学籍番号": "7228095", "氏名": "藤井　陽向", "卒業論文タイトル": "保幼小を見通した、水遊び・水泳運動の指導計画の検討", "ページ": "p.84", "会場": "B201", "発表開始時刻": "11:30"}, {"学籍番号": "7228097", "氏名": "藤原　多花", "卒業論文タイトル": "音楽で育つ心－保育におけるレゲエ音楽の活用可能性－", "ページ": "p.85", "会場": "B101", "発表開始時刻": "11:00"}, {"学籍番号": "7228098", "氏名": "豊後　里奈", "卒業論文タイトル": "『千と千尋の神隠し』に描かれる怖さと成長
-ファンタジーによる心理的体験-", "ページ": "p.86", "会場": "B303", "発表開始時刻": "10:30"}, {"学籍番号": "7228099", "氏名": "保坂　琴里", "卒業論文タイトル": "各国の教育の比較からみる日本の課題", "ページ": "p.87", "会場": "B201", "発表開始時刻": "10:00"}, {"学籍番号": "7228100", "氏名": "細川　將之輔", "卒業論文タイトル": "幼児期の飼育経験の有無による共感性の違い", "ページ": "p.88", "会場": "B401", "発表開始時刻": "13:30"}, {"学籍番号": "7228101", "氏名": "堀越　朋花", "卒業論文タイトル": "K-POPファンが推しに感じる魅力の多様性", "ページ": "p.89", "会場": "B303", "発表開始時刻": "10:45"}, {"学籍番号": "7228102", "氏名": "前田　紗矢子", "卒業論文タイトル": "脱ジェンダーおもちゃとジェンダー意識との関連性", "ページ": "p.90", "会場": "B303", "発表開始時刻": "11:00"}, {"学籍番号": "7228103", "氏名": "増田　愛菜穂", "卒業論文タイトル": "幼児期におけるKAPLAブロックを用いた遊びの年齢別特徴", "ページ": "p.91", "会場": "B402", "発表開始時刻": "13:30"}, {"学籍番号": "7228104", "氏名": "松本　愛", "卒業論文タイトル": "教育虐待の防止～家庭教育の在り方とは～", "ページ": "p.92", "会場": "B404", "発表開始時刻": "10:30"}, {"学籍番号": "7228106", "氏名": "真鍋　桜", "卒業論文タイトル": "障がい児と折り紙
～発達障害がある子どもへの折り紙遊びにおける支援～", "ページ": "p.93", "会場": "A201", "発表開始時刻": "10:00"}, {"学籍番号": "7228107", "氏名": "水田　淑史", "卒業論文タイトル": "仮面ライダーシリーズを通して子ども達に何を伝えようとしているか", "ページ": "p.94", "会場": "B404", "発表開始時刻": "10:45"}, {"学籍番号": "7228108", "氏名": "宮本　悠佑", "卒業論文タイトル": "小学校国語科における「ごんぎつね」の指導法について", "ページ": "p.95", "会場": "A201", "発表開始時刻": "13:15"}, {"学籍番号": "7228109", "氏名": "村上　真悠", "卒業論文タイトル": "推し活が人の心理に与える影響に関する考察", "ページ": "p.96", "会場": "B404", "発表開始時刻": "13:15"}, {"学籍番号": "7228110", "氏名": "八尾　咲里奈", "卒業論文タイトル": "教育現場における動物飼育の実践とアニマルセラピーの効果", "ページ": "p.97", "会場": "B403", "発表開始時刻": "10:45"}, {"学籍番号": "7228111", "氏名": "八坂　陽奈", "卒業論文タイトル": "せなけいこのおばけ絵本の魅力
～インターンシップでの読み聞かせ実践から学んだこと～", "ページ": "p.98", "会場": "B303", "発表開始時刻": "14:00"}, {"学籍番号": "7228112", "氏名": "安原　ゆうか", "卒業論文タイトル": "理想の園庭の構想とその活用課題 
―幼稚園施設整備指針と「園庭の現状」調査を踏まえて―", "ページ": "p.99", "会場": "B201", "発表開始時刻": "13:30"}, {"学籍番号": "7228114", "氏名": "山口　世梨香", "卒業論文タイトル": "子どもの生活に広がる『はらぺこあおむし』の絵本
～エリック・カールの紙づくりに着目して～", "ページ": "p.100", "会場": "B201", "発表開始時刻": "13:45"}, {"学籍番号": "7228115", "氏名": "山口　陽香", "卒業論文タイトル": "就学期以降における保護者支援の不存在に関する研究", "ページ": "p.101", "会場": "B304", "発表開始時刻": "10:15"}, {"学籍番号": "7228116", "氏名": "山成　双葉", "卒業論文タイトル": "障害理解教育と教師の共感性の関係", "ページ": "p.102", "会場": "B304", "発表開始時刻": "14:00"}, {"学籍番号": "7218015", "氏名": "内海　千皓", "卒業論文タイトル": "児童虐待の現状と保育者・教師の支援のあり方", "ページ": "p.103", "会場": "B304", "発表開始時刻": "13:30"}, {"学籍番号": "724H001", "氏名": "伊藤　愛莉", "卒業論文タイトル": "自己効力感を高めるには―叱る教育からの考察―", "ページ": "p.104", "会場": "B304", "発表開始時刻": "13:45"}, {"学籍番号": "7228501", "氏名": "浅井　優希菜", "卒業論文タイトル": "なぜ子どもはバイキンマンに惹かれるのか
～悪役が担う教育的役割～", "ページ": "p.105", "会場": "B404", "発表開始時刻": "13:30"}, {"学籍番号": "7228502", "氏名": "石田　結花", "卒業論文タイトル": "大学の授業における学生が眠くなりにくい
授業にする為の教育方法面での工夫", "ページ": "p.106", "会場": "B404", "発表開始時刻": "11:00"}, {"学籍番号": "7228503", "氏名": "石原　琉雅", "卒業論文タイトル": "乳幼児期における感情表出の要因", "ページ": "p.107", "会場": "B402", "発表開始時刻": "11:30"}, {"学籍番号": "7228504", "氏名": "井手　希泉", "卒業論文タイトル": "教育方法による子どもへの影響
～現代に求められる保育～", "ページ": "p.108", "会場": "B403", "発表開始時刻": "11:00"}, {"学籍番号": "7228505", "氏名": "井上　乃絵留", "卒業論文タイトル": "色彩が運動能力に及ぼす影響", "ページ": "p.109", "会場": "B101", "発表開始時刻": "13:15"}, {"学籍番号": "7228506", "氏名": "植木　千結", "卒業論文タイトル": "絵本がひらく子どもの世界 
-絵本を通して育つ子どものちから-", "ページ": "p.110", "会場": "B403", "発表開始時刻": "11:15"}, {"学籍番号": "7228507", "氏名": "上原　優真", "卒業論文タイトル": "ヨシタケシンスケの絵本の魅力と保育現場での活用方法", "ページ": "p.111", "会場": "A201", "発表開始時刻": "13:30"}, {"学籍番号": "7228508", "氏名": "内田　怜唯", "卒業論文タイトル": "幼児期の音楽経験と歌うことに対する苦手意識について", "ページ": "p.112", "会場": "B403", "発表開始時刻": "13:15"}, {"学籍番号": "7228509", "氏名": "大西　深月", "卒業論文タイトル": "人形遊びで育まれる力
～リカちゃん人形とシルバニアファミリーの比較から～", "ページ": "p.113", "会場": "B402", "発表開始時刻": "13:45"}, {"学籍番号": "7228510", "氏名": "織田　美月", "卒業論文タイトル": "ディズニー音楽を保育現場で活かすために", "ページ": "p.114", "会場": "B101", "発表開始時刻": "11:15"}, {"学籍番号": "7228511", "氏名": "笠井　麻鈴", "卒業論文タイトル": "日米の絵本の違いによる子どもの育ちへの影響", "ページ": "p.115", "会場": "B301", "発表開始時刻": "13:15"}, {"学籍番号": "7228512", "氏名": "勝見　ののは", "卒業論文タイトル": "好きなキャラクターと性格の関連性", "ページ": "p.116", "会場": "B301", "発表開始時刻": "13:30"}, {"学籍番号": "7228516", "氏名": "髙橋　彩花", "卒業論文タイトル": "障がいを疑われる子どもを育てる保護者への支援のあり方", "ページ": "p.117", "会場": "B404", "発表開始時刻": "13:45"}, {"学籍番号": "7228517", "氏名": "武内　真弥", "卒業論文タイトル": "乳幼児期における自然体験の重要性", "ページ": "p.118", "会場": "B101", "発表開始時刻": "13:30"}, {"学籍番号": "7228518", "氏名": "谷掛　心暖", "卒業論文タイトル": "和太鼓を取り入れた保育について", "ページ": "p.119", "会場": "B403", "発表開始時刻": "13:30"}, {"学籍番号": "7228519", "氏名": "佐野　雅紘", "卒業論文タイトル": "父親向け子育て支援制度の現状と今後の在り方", "ページ": "p.120", "会場": "B101", "発表開始時刻": "11:30"}, {"学籍番号": "7228520", "氏名": "道家　真帆", "卒業論文タイトル": "日本とカナダの保育における子どもの主体性の違い", "ページ": "p.121", "会場": "B304", "発表開始時刻": "10:30"}, {"学籍番号": "7228521", "氏名": "楢崎　智採", "卒業論文タイトル": "愛着形成は人間関係や状況にどのように影響するのか", "ページ": "p.122", "会場": "B301", "発表開始時刻": "13:45"}, {"学籍番号": "7228522", "氏名": "野村　朝香", "卒業論文タイトル": "ASD（自閉スペクトラム症）の子どもをもつ保護者の
障害受容と子育て支援について", "ページ": "p.123", "会場": "A201", "発表開始時刻": "10:15"}, {"学籍番号": "7228523", "氏名": "萩原　春乃", "卒業論文タイトル": "日本における里親制度の現状
～海外との比較による支援検討～", "ページ": "p.124", "会場": "B403", "発表開始時刻": "11:30"}, {"学籍番号": "7228524", "氏名": "橋本　咲子", "卒業論文タイトル": "幼少期の動物飼育経験がその後の動物観に与える影響", "ページ": "p.125", "会場": "B403", "発表開始時刻": "13:45"}, {"学籍番号": "7228525", "氏名": "東　由美", "卒業論文タイトル": "児童養護施設の実態と未来
-子どもと職員の視点を中心に-", "ページ": "p.126", "会場": "B304", "発表開始時刻": "13:15"}, {"学籍番号": "7228526", "氏名": "東　和佳奈", "卒業論文タイトル": "医療的ケア児の現状と課題
～一生涯を通じたより良い支援の在り方について～", "ページ": "p.127", "会場": "A201", "発表開始時刻": "10:30"}, {"学籍番号": "7228527", "氏名": "久泉　奈々", "卒業論文タイトル": "ユニバーサルデザインの理念と実践
―教育施設・製品・社会の応用と今後の展望―", "ページ": "p.128", "会場": "B401", "発表開始時刻": "14:00"}, {"学籍番号": "7228528", "氏名": "深田　愛実", "卒業論文タイトル": "愛着障害から生じる心と行動の問題 
-愛着障害の基本的理解に基づく考察-", "ページ": "p.129", "会場": "A301", "発表開始時刻": "10:45"}, {"学籍番号": "7228529", "氏名": "福富　水萌", "卒業論文タイトル": "香りが運動パフォーマンスに及ぼす影響", "ページ": "p.130", "会場": "B101", "発表開始時刻": "13:45"}, {"学籍番号": "7228530", "氏名": "藤枝　りな", "卒業論文タイトル": "乳幼児期における英語活動の重要性", "ページ": "p.131", "会場": "B403", "発表開始時刻": "14:00"}, {"学籍番号": "7228531", "氏名": "増田　雅輝", "卒業論文タイトル": "色が人に与える心理的影響", "ページ": "p.132", "会場": "B301", "発表開始時刻": "14:00"}, {"学籍番号": "7228532", "氏名": "宮下　歩美", "卒業論文タイトル": "障害者を取り巻く生活環境と社会の問題
～違いを認め合える社会についての一考察～", "ページ": "p.133", "会場": "A301", "発表開始時刻": "11:00"}, {"学籍番号": "7228533", "氏名": "門前　穂佑", "卒業論文タイトル": "人見知りや場所見知りと発達特性との関係について
～内向的な子どもとの関わり方～", "ページ": "p.134", "会場": "A301", "発表開始時刻": "11:15"}, {"学籍番号": "7228534", "氏名": "山口　未来", "卒業論文タイトル": "絵本のなかの死について―死はどのように描かれているか―", "ページ": "p.135", "会場": "A201", "発表開始時刻": "13:45"}, {"学籍番号": "7228535", "氏名": "山﨑　琉莉", "卒業論文タイトル": "発達特性を踏まえた子どもへの関わり方
～インターンシップ実習での事例から～", "ページ": "p.136", "会場": "A301", "発表開始時刻": "11:30"}, {"学籍番号": "7228536", "氏名": "山田　愛奈", "卒業論文タイトル": "出生順位と家庭環境が子どもの性格形成と人間関係に与える影響", "ページ": "p.137", "会場": "B201", "発表開始時刻": "14:00"}];
  const $ = (id) => document.getElementById(id);

  const LS_KEY = "sotsuron_favorites_v1"; // stores array of 学籍番号
  function loadFavSet() {
    try {
      const raw = localStorage.getItem(LS_KEY);
      const arr = raw ? JSON.parse(raw) : [];
      return new Set(Array.isArray(arr) ? arr : []);
    } catch (e) {
      return new Set();
    }
  }
  function saveFavSet(set) {
    const arr = Array.from(set);
    localStorage.setItem(LS_KEY, JSON.stringify(arr));
  }
  let favSet = loadFavSet();

  function syncFavCounters() {
    const n = favSet.size;
    $("favCount").textContent = String(n);
    $("favCount2").textContent = String(n);
    $("favCount3").textContent = String(n);
  }

  function norm(s, ignoreCase) {
    const t = (s ?? "").toString();
    return ignoreCase ? t.toLowerCase() : t;
  }

  function escapeHtml(s) {
    return String(s ?? "").replace(/[&<>"']/g, (c) => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
  }

  function escapeRegExp(str) {
    return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
  }

  function tokenize(q) {
    return q.trim().split(/\s+/).filter(Boolean);
  }

  function highlightText(text, tokens, ignoreCase) {
    if (!$("highlight").checked || !tokens.length) return escapeHtml(text);
    let out = escapeHtml(text);
    const sorted = [...tokens].sort((a,b)=>b.length-a.length);
    for (const tok of sorted) {
      if (!tok) continue;
      const re = new RegExp(escapeRegExp(tok), ignoreCase ? "gi" : "g");
      out = out.replace(re, (m) => `<mark>${m}</mark>`);
    }
    return out;
  }

  function matchRecord(rec, tokens, ignoreCase, andMode, searchAll) {
    const fields = searchAll
      ? [rec["卒業論文タイトル"], rec["氏名"], rec["学籍番号"], rec["会場"], rec["ページ"], rec["発表開始時刻"]]
      : [rec["卒業論文タイトル"]];
    const hay = norm(fields.join(" "), ignoreCase);

    if (!tokens.length) return false;
    if (andMode) return tokens.every(t => hay.includes(norm(t, ignoreCase)));
    return tokens.some(t => hay.includes(norm(t, ignoreCase)));
  }

  function makeStarButton(id) {
    const pressed = favSet.has(id);
    return `
      <button class="starBtn" type="button" aria-label="お気に入り" aria-pressed="${pressed}">
        <span class="star ${pressed ? "on" : ""}">${pressed ? "★" : "☆"}</span>
      </button>
    `;
  }

  function renderTable(list, tokens, ignoreCase) {
    const tbody = $("tbody");
    tbody.innerHTML = "";
    if (!list.length) {
      tbody.innerHTML = `<tr><td colspan="7" class="muted">ヒットなし</td></tr>`;
      return;
    }
    const frag = document.createDocumentFragment();
    for (const rec of list) {
      const tr = document.createElement("tr");
      tr.dataset.id = rec["学籍番号"];
      tr.innerHTML = `
        <td>${makeStarButton(rec["学籍番号"])}</td>
        <td class="mono nowrap">${escapeHtml(rec["学籍番号"])}</td>
        <td class="nowrap">${escapeHtml(rec["氏名"])}</td>
        <td class="wrap">${highlightText(rec["卒業論文タイトル"], tokens, ignoreCase)}</td>
        <td class="mono nowrap">${escapeHtml(rec["ページ"])}</td>
        <td class="mono nowrap">${escapeHtml(rec["会場"])}</td>
        <td class="mono nowrap">${escapeHtml(rec["発表開始時刻"])}</td>
      `;
      frag.appendChild(tr);
    }
    tbody.appendChild(frag);
  }

  function renderList(list, tokens, ignoreCase) {
    const box = $("list");
    box.innerHTML = "";
    if (!list.length) {
      box.innerHTML = `<div class="muted">ヒットなし</div>`;
      return;
    }
    const frag = document.createDocumentFragment();
    for (const rec of list) {
      const div = document.createElement("div");
      div.className = "item";
      div.dataset.id = rec["学籍番号"];
      div.innerHTML = `
        <div>${makeStarButton(rec["学籍番号"])}</div>
        <div class="itemMain">
          <div class="meta" style="margin-bottom:6px;">
            <span class="pill mono">#${escapeHtml(rec["学籍番号"])}</span>
            <span class="pill">${escapeHtml(rec["氏名"])}</span>
            <span class="pill mono">${escapeHtml(rec["ページ"])}</span>
            <span class="pill mono">${escapeHtml(rec["会場"])}</span>
            <span class="pill mono">${escapeHtml(rec["発表開始時刻"])}</span>
          </div>
          <div class="title">${highlightText(rec["卒業論文タイトル"], tokens, ignoreCase)}</div>
        </div>
      `;
      frag.appendChild(div);
    }
    frag.childNodes.forEach(n => box.appendChild(n));
  }

  function renderResults(list, tokens, ignoreCase) {
    $("hit").textContent = String(list.length);
    $("resultsHint").textContent = list.length ? "結果（★でお気に入り登録）" : "ヒットなし";
    renderTable(list, tokens, ignoreCase);
    renderList(list, tokens, ignoreCase);
  }

  function doSearch() {
    const q = $("q").value;
    const tokens = tokenize(q);
    const ignoreCase = $("ignoreCase").checked;
    const andMode = $("andMode").checked;
    const searchAll = $("searchAll").checked;

    if (!tokens.length) {
      $("hit").textContent = "0";
      $("resultsHint").textContent = "検索語を入力して検索してください。";
      $("tbody").innerHTML = `<tr><td colspan="7" class="muted">検索語を入力して検索してください。</td></tr>`;
      $("list").innerHTML = "";
      return;
    }

    const hit = DATA.filter(rec => matchRecord(rec, tokens, ignoreCase, andMode, searchAll));
    renderResults(hit, tokens, ignoreCase);
  }

  function resetResults() {
    $("q").value = "";
    $("hit").textContent = "0";
    $("resultsHint").textContent = "検索語を入力して検索してください。";
    $("tbody").innerHTML = `<tr><td colspan="7" class="muted">検索語を入力して検索してください。</td></tr>`;
    $("list").innerHTML = "";
  }

  function getFavRecords() {
    // keep original ordering of DATA
    const set = favSet;
    return DATA.filter(r => set.has(r["学籍番号"]));
  }

  function doFavSearch() {
    const q = $("fq").value;
    const tokens = tokenize(q);
    const ignoreCase = true;
    const andMode = $("andMode").checked; // reuse
    const searchAll = true;

    const favRecs = getFavRecords();
    if (!tokens.length) {
      renderFav(favRecs, [], ignoreCase);
      return;
    }
    const hit = favRecs.filter(rec => matchRecord(rec, tokens, ignoreCase, andMode, searchAll));
    renderFav(hit, tokens, ignoreCase);
  }

  function renderFav(list, tokens, ignoreCase) {
    // reuse results area for favorites display
    $("resultsHint").textContent = list.length ? "お気に入り（★で解除）" : "お気に入りがありません";
    // counters
    // show in hit too
    $("hit").textContent = String(list.length);
    renderTable(list, tokens, ignoreCase);
    renderList(list, tokens, ignoreCase);
  }

  function exportFavCSV() {
    const rows = getFavRecords();
    const header = ["学籍番号","氏名","卒業論文タイトル","ページ","会場","発表開始時刻"];
    const esc = (v) => `"${String(v ?? "").replaceAll('"','""')}"`;
    const lines = [header.join(",")].concat(
      rows.map(r => header.map(h => esc(r[h])).join(","))
    );
    const blob = new Blob([lines.join("\n")], { type: "text/csv;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "お気に入り_卒論検索.csv";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function setTab(which) {
    const isSearch = which === "search";
    $("tabSearch").classList.toggle("active", isSearch);
    $("tabFav").classList.toggle("active", !isSearch);
    $("panelSearch").style.display = isSearch ? "" : "none";
    $("panelFav").style.display = isSearch ? "none" : "";
    if (isSearch) {
      // keep current search results
      if ($("q").value.trim()) doSearch();
      else resetResults();
    } else {
      // show favorites list
      $("fq").value = "";
      renderFav(getFavRecords(), [], true);
    }
  }

  function toggleFavorite(id) {
    if (favSet.has(id)) favSet.delete(id);
    else favSet.add(id);
    saveFavSet(favSet);
    syncFavCounters();

    // update all star buttons for that id currently in DOM
    document.querySelectorAll(`[data-id="${CSS.escape(id)}"] .starBtn`).forEach(btn => {
      const pressed = favSet.has(id);
      btn.setAttribute("aria-pressed", pressed ? "true" : "false");
      const star = btn.querySelector(".star");
      if (star) {
        star.textContent = pressed ? "★" : "☆";
        star.classList.toggle("on", pressed);
      }
    });

    // If we're in favorites tab, re-render list to reflect removals
    if ($("tabFav").classList.contains("active")) {
      doFavSearch();
    }
  }

  // Event delegation for star buttons
  document.addEventListener("click", (e) => {
    const btn = e.target.closest(".starBtn");
    if (!btn) return;
    const row = btn.closest("[data-id]");
    if (!row) return;
    toggleFavorite(row.dataset.id);
  });

  // Wire controls
  $("total").textContent = String(DATA.length);
  syncFavCounters();

  $("search").addEventListener("click", doSearch);
  $("q").addEventListener("keydown", (e) => { if (e.key === "Enter") doSearch(); });
  $("clear").addEventListener("click", resetResults);

  $("fsearch").addEventListener("click", doFavSearch);
  $("fq").addEventListener("keydown", (e) => { if (e.key === "Enter") doFavSearch(); });
  $("fclear").addEventListener("click", () => { $("fq").value=""; renderFav(getFavRecords(), [], true); });
  $("exportFav").addEventListener("click", exportFavCSV);

  $("clearFav").addEventListener("click", () => {
    if (!confirm("お気に入りを全て解除します。よろしいですか？")) return;
    favSet = new Set();
    saveFavSet(favSet);
    syncFavCounters();
    renderFav([], [], true);
  });

  $("tabSearch").addEventListener("click", () => setTab("search"));
  $("tabFav").addEventListener("click", () => setTab("fav"));

  ["ignoreCase","andMode","searchAll","highlight"].forEach(id => {
    $(id).addEventListener("change", () => {
      if ($("tabFav").classList.contains("active")) {
        doFavSearch();
      } else {
        if ($("q").value.trim()) doSearch();
      }
    });
  });
</script>
</body>
</html>
